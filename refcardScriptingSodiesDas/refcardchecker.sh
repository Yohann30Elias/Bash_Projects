#!/bin/bash

# Definieren eines Arrays mit Base64-codierten Terraform-Blöcken
encoded_blocks=(
    "dGVycmFmb3JtIHsKICByZXF1aXJlZF9wcm92aWRlcnMgewogICAgYXdzID0gewogICAgICBzb3VyY2UgID0gImhhc2hpY29ycC9hd3MiCiAgICAgIHZlcnNpb24gPSAifj4gNS4wIgogICAgfQogIH0KfQoK"
    "cHJvdmlkZXIgImF3cyIgewogIHJlZ2lvbiA9ICJ1cy13ZXN0LTIiCn0KCg=="
    "cmVzb3VyY2UgImF3c192cGMiICJtYWluIiB7CiAgY2lkcl9ibG9jayA9ICIxMC4wLjAuMC8xNiIKICBlbmFibGVfZG5zX2hvc3RuYW1lcyA9IHRydWUKfQoK"
    "cmVzb3VyY2UgImF3c19pbnRlcm5ldF9nYXRld2F5IiAibWFpbiIgewogIHZwY19pZCA9IGF3c192cGMubWFpbi5pZAp9Cgo="
    "cmVzb3VyY2UgImF3c19zdWJuZXQiICJwdWJsaWMiIHsKICB2cGNfaWQgICAgICAgICAgICAgICAgICA9IGF3c192cGMubWFpbi5pZAogIGNpZHJfYmxvY2sgICAgICAgICAgICAgID0gIjEwLjAuMC4wLzI0IgogIG1hcF9wdWJsaWNfaXBfb25fbGF1bmNoID0gdHJ1ZQp9Cgo="
    "cmVzb3VyY2UgImF3c19zdWJuZXQiICJwcml2YXRlIiB7CiAgY291bnQgPSAyCiAgdnBjX2lkID0gYXdzX3ZwYy5tYWluLmlkCiAgY2lkcl9ibG9jayA9IGNpZHJzdWJuZXQoYXdzX3ZwYy5tYWluLmNpZHJfYmxvY2ssIDgsIDEwICsgY291bnQuaW5kZXgpCiAgYXZhaWxhYmlsaXR5X3pvbmUgPSBkYXRhLmF3c19hdmFpbGFiaWxpdHlfem9uZXMuYXZhaWxhYmxlLm5hbWVzW2NvdW50LmluZGV4XQogIHRhZ3MgPSB7CiAgICBOYW1lID0gInByaXZhdGVfJHtkYXRhLmF3c19hdmFpbGFiaWxpdHlfem9uZXMuYXZhaWxhYmxlLm5hbWVzW2NvdW50LmluZGV4XX0iCiAgfQp9Cgo="
    "ZGF0YSAiYXdzX2F2YWlsYWJpbGl0eV96b25lcyIgImF2YWlsYWJsZSIgewogIHN0YXRlID0gImF2YWlsYWJsZSIKfQoK"
    "cmVzb3VyY2UgImF3c19yb3V0ZV90YWJsZSIgInB1YmxpYyIgewogIHZwY19pZCA9IGF3c192cGMubWFpbi5pZAogIHJvdXRlIHsKICAgIGNpZHJfYmxvY2sgPSAiMC4wLjAuMC8wIgogICAgZ2F0ZXdheV9pZCA9IGF3c19pbnRlcm5ldF9nYXRld2F5Lm1haW4uaWQKICB9Cn0KCg=="
    "cmVzb3VyY2UgImF3c19yb3V0ZV90YWJsZV9hc3NvY2lhdGlvbiIgInB1YmxpYyIgewogIHJvdXRlX3RhYmxlX2lkID0gYXdzX3JvdXRlX3RhYmxlLnB1YmxpYy5pZAogIHN1Ym5ldF9pZCA9IGF3c19zdWJuZXQucHVibGljLmlkCn0KCg=="
    "cmVzb3VyY2UgImF3c19yb3V0ZV90YWJsZSIgInByaXZhdGUiIHsKICB2cGNfaWQgPSBhd3NfdnBjLm1haW4uaWQKfQoK"
    "cmVzb3VyY2UgImF3c19yb3V0ZV90YWJsZV9hc3NvY2lhdGlvbiIgInByaXZhdGUiIHsKICBjb3VudCA9IGxlbmd0aChhd3Nfc3VibmV0LnByaXZhdGUpCiAgcm91dGVfdGFibGVfaWQgPSBhd3Nfcm91dGVfdGFibGUucHJpdmF0ZS5pZAogIHN1Ym5ldF9pZCA9IGF3c19zdWJuZXQucHJpdmF0ZVtjb3VudC5pbmRleF0uaWQKfQoK"
    "cmVzb3VyY2UgImF3c19zZWN1cml0eV9ncm91cCIgImVjMiIgewogIG5hbWUgICAgICAgID0gImVjMi1hbGxvdy1zc2gtaHR0cCIKICBkZXNjcmlwdGlvbiA9ICJTZWN1cml0eSBncm91cCBmb3IgdGhlIEVDMiBpbnN0YW5jZSIKICB2cGNfaWQgICAgICA9IGF3c192cGMubWFpbi5pZAoKICBpbmdyZXNzIHsKICAgIGZyb21fcG9ydCAgID0gMjIKICAgIHRvX3BvcnQgICAgID0gMjIKICAgIHByb3RvY29sICAgID0gInRjcCIKICAgIGNpZHJfYmxvY2tzID0gWyIwLjAuMC4wLzAiXQogIH0KICBpbmdyZXNzIHsKICAgIGZyb21fcG9ydCAgID0gODAKICAgIHRvX3BvcnQgICAgID0gODA4MAogICAgcHJvdG9jb2wgICAgPSAidGNwIgogICAgY2lkcl9ibG9ja3MgPSBbIjAuMC4wLjAuMC8wIl0KICB9CiAgZWdyZXNzIHsKICAgIGZyb21fcG9ydCAgID0gMAogICAgdG9fcG9ydCAgICAgPSAwCiAgICBwcm90b2NvbCAgICA9ICItMSIKICAgIGNpZHJfYmxvY2tzID0gWyIwLjAuMC4wLzAiXQogIH0KfQoK"
    "cmVzb3VyY2UgImF3c19zZWN1cml0eV9ncm91cCIgInJkcyIgewogIG5hbWUgICAgICAgID0gInJkcy1hbGxvdy1zcWwiCiAgZGVzY3JpcHRpb24gPSAiU2VjdXJpdHkgZ3JvdXAgZm9yIHRoZSBSRFMgaW5zdGFuY2UiCiAgdnBjX2lkICAgICAgPSBhd3NfdnBjLm1haW4uaWQKCiAgaW5ncmVzcyB7CiAgICBmcm9tX3BvcnQgICAgICAgPSAzMzA2CiAgICB0b19wb3J0ICAgICAgICAgPSAzMzA2CiAgICBwcm90b2NvbCAgICAgICAgPSAidGNwIgogICAgc2VjdXJpdHlfZ3JvdXBzID0gW2F3c19zZWN1cml0eV9ncm91cC5lYzIuaWRdCiAgfQp9Cgo="
    "cmVzb3VyY2UgImF3c19kYl9pbnN0YW5jZSIgIm1hcmlhZGIiIHsKICBhbGxvY2F0ZWRfc3RvcmFnZSAgICAgID0gMjAKICBzdG9yYWdlX3R5cGUgICAgICAgICAgID0gImdwMiIKICBlbmdpbmUgICAgICAgICAgICAgICAgID0gIm1hcmlhZGIiCiAgZW5naW5lX3ZlcnNpb24gICAgICAgICA9ICIxMC42LjE0IgogIGluc3RhbmNlX2NsYXNzICAgICAgICAgPSAiZGIudDIubWljcm8iCiAgZGJfbmFtZSAgICAgICAgICAgICAgICA9ICJtYXJpYWRiIgogIHVzZXJuYW1lICAgICAgICAgICAgICAgPSAiYWRtaW4iCiAgcGFzc3dvcmQgICAgICAgICAgICAgICA9ICJteXBhc3N3b3JkIgogIHNraXBfZmluYWxfc25hcHNob3QgICAgPSB0cnVlCiAgdnBjX3NlY3VyaXR5X2dyb3VwX2lkcyA9IFthd3Nfc2VjdXJpdHlfZ3JvdXAucmRzLmlkXQogIGRiX3N1Ym5ldF9ncm91cF9uYW1lICAgPSBhd3NfZGJfc3VibmV0X2dyb3VwLnByaXZhdGUubmFtZQp9Cgo="
    "cmVzb3VyY2UgImF3c19kYl9zdWJuZXRfZ3JvdXAiICJwcml2YXRlIiB7CiAgbmFtZSAgICAgICA9ICJkYl9zdWJuZXRfZ3JvdXAiCiAgc3VibmV0X2lkcyA9IFtmb3Igc3VibmV0IGluIGF3c19zdWJuZXQucHJpdmF0ZSA6IHN1Ym5ldC5pZF0KfQoK"
    "ZGF0YSAiYXdzX2FtaSIgInVidW50dV8yMl8wNCIgewogIG1vc3RfcmVjZW50ID0gdHJ1ZQogIGZpbHRlciB7CiAgICBuYW1lICAgPSAibmFtZSIKICAgIHZhbHVlcyA9IFsidWJ1bnR1L2ltYWdlcy9odm0tc3NkL3VidW50dS1qYW1teS0yMi4wNC1hbWQ2NC1zZXJ2ZXItKiJdCiAgfQogIGZpbHRlciB7CiAgICBuYW1lICAgPSAidmlydHVhbGl6YXRpb24tdHlwZSIKICAgIHZhbHVlcyA9IFsiaHZtIl0KICB9CiAgb3duZXJzID0gWyIwOTk3MjAxMDk0NzciXQp9Cgo="
    "cmVzb3VyY2UgImF3c19pbnN0YW5jZSIgImVjMl9pbnN0YW5jZSIgewogIGFtaSAgICAgICAgICAgICAgICAgICAgPSBkYXRhLmF3c19hbWkudWJ1bnR1XzIyXzA0LmlkCiAgaW5zdGFuY2VfdHlwZSAgICAgICAgICA9ICJ0Mi5taWNybyIKICBzdWJuZXRfaWQgICAgICAgICAgICAgID0gYXdzX3N1Ym5ldC5wdWJsaWMuaWQKICB2cGNfc2VjdXJpdHlfZ3JvdXBfaWRzID0gW2F3c19zZWN1cml0eV9ncm91cC5lYzIuaWRdCiAga2V5X25hbWUgICAgICAgICAgICAgICA9IGF3c19rZXlfcGFpci5yc2Eua2V5X25hbWUKfQoK"
    "cmVzb3VyY2UgImF3c19rZXlfcGFpciIgInJzYSIgewogIGtleV9uYW1lICAgPSAic3NoX2tleSIKICBwdWJsaWNfa2V5ID0gZmlsZSgifi8uc3NoL2lkX3JzYS5wdWIiKQp9Cgo="
    "b3V0cHV0ICJ3ZWJfcHVibGljX2lwIiB7CiAgZGVzY3JpcHRpb24gPSAiVGhlIHB1YmxpYyBJUCBhZGRyZXNzIG9mIHRoZSB3ZWIgc2VydmVyIgogIHZhbHVlICAgICAgID0gYXdzX2luc3RhbmNlLmVjMl9pbnN0YW5jZS5wdWJsaWNfaXAKfQoK"
    "b3V0cHV0ICJkYXRhYmFzZV9lbmRwb2ludCIgewogIGRlc2NyaXB0aW9uID0gIlRoZSBlbmRwb2ludCBvZiB0aGUgZGF0YWJhc2UiCiAgdmFsdWUgICAgICAgPSBhd3NfZGJfaW5zdGFuY2UubWFyaWFkYi5hZGRyZXNzCn0KCg=="
    "b3V0cHV0ICJkYXRhYmFzZV9wb3J0IiB7CiAgZGVzY3JpcHRpb24gPSAiVGhlIHBvcnQgb2YgdGhlIGRhdGFiYXNlIgogIHZhbHVlICAgICAgID0gYXdzX2RiX2luc3RhbmNlLm1hcmlhZGIucG9ydAp9Cgo="
)

# Pfad zur externen .tf Datei, die verglichen werden soll
external_tf="$1"

# Überprüfung, ob ein Dateipfad angegeben wurde
if [ -z "$external_tf" ]; then
    echo "Bitte geben Sie den Pfad zur zu vergleichenden Datei an."
    exit 1
fi

# Entfernen aller Leerzeichen und Zeilenumbrüche in der externen Datei für den Vergleich
tr -d '[:space:]' < "$external_tf" > formatted_external.tf

# Iteration durch jedes codierte Block-Array
for block in "${encoded_blocks[@]}"; do
    echo "$block" | base64 --decode > decoded_block.tf
    tr -d '[:space:]' < decoded_block.tf > formatted_decoded_block.tf

    # Überprüfen, ob der Block in der externen Datei existiert
    if grep -Fq "$(cat formatted_decoded_block.tf)" formatted_external.tf; then
        echo "Ein übereinstimmender Block wurde gefunden."
        match_found=true
        break
    fi
done

# Ergebnis der Überprüfung
if [ "$match_found" != true ]; then
    echo "Kein übereinstimmender Block gefunden."
fi

# Aufräumen der temporären Dateien
rm decoded_block.tf formatted_decoded_block.tf formatted_external.tf
